<!-- templates/index.html -->

<!-- templates/index.html -->

<!--<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Flashcards</title>
    
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        form {
            max-width: 600px;
            margin: 0 auto 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        textarea, input[type=number] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #218838;
        }
        .flashcards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        .card {
            width: 18rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: scale(1.02);
        }
        .card-body {
            position: relative;
        }
        .answer {
            display: none;
            margin-top: 10px;
            color: #555;
        }
        .card.active .answer {
            display: block;
        }
    </style>
</head>
<body>
    <h1>Generate Flashcards</h1>
    <form id="flashcardForm" method="POST">
        {% csrf_token %}
        <textarea id="text" name="text" placeholder="Enter text here..." required></textarea><br>
        <input type="number" id="num_flashcards" name="num_flashcards_limit" placeholder="Number of Flashcards" required min="1"><br>
        <button type="submit">Generate Flashcards</button>
    </form>
    <div id="flashcards" class="flashcards-container"></div>-->

    <!-- Bootstrap JS and dependencies -->
    <!--<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.getElementById('flashcardForm').onsubmit = async function(e) {
            e.preventDefault();
            const text = document.getElementById('text').value;
            const num_flashcards = document.getElementById('num_flashcards').value;
            const csrfToken = getCookie('csrftoken');

            try {
                const response = await fetch('/generate_flashcards/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken  // Inclure le token CSRF
                    },
                    body: JSON.stringify({ text, num_flashcards_limit: num_flashcards }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error occurred while generating flashcards.');
                }

                const data = await response.json();
                const flashcardsDiv = document.getElementById('flashcards');
                flashcardsDiv.innerHTML = '';

                if (data.flashcards && data.flashcards.length > 0) {
                    data.flashcards.forEach(flashcard => {
                        const card = document.createElement('div');
                        card.className = 'card';

                        const cardBody = document.createElement('div');
                        cardBody.className = 'card-body';

                        const question = document.createElement('h5');
                        question.className = 'card-title';
                        question.textContent = flashcard.question;

                        const answer = document.createElement('p');
                        answer.className = 'card-text answer';
                        answer.textContent = flashcard.answer;

                        cardBody.appendChild(question);
                        cardBody.appendChild(answer);
                        card.appendChild(cardBody);

                        // Ajouter un gestionnaire d'événements pour afficher la réponse au clic
                        card.addEventListener('click', function() {
                            this.classList.toggle('active');
                        });

                        flashcardsDiv.appendChild(card);
                    });
                } else {
                    flashcardsDiv.innerHTML = '<p>No flashcards generated.</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        };

        // Fonction pour obtenir le token CSRF depuis les cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Vérifie si ce cookie commence par le nom souhaité
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>-->
<!-- templates/index.html -->

<!-- templates/index.html -->

<!-- templates/index.html -->

<!-- templates/index.html -->

<!-- flashcards/templates/flashcards/index.html -->

<!-- flashcards/templates/flashcards/generate_flashcards.html -->
{% include 'header.html' %}
{% include 'nav.html' %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Flashcards</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Vos styles existants */
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1, h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        form {
            max-width: 600px;
            margin: 0 auto 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        textarea, input[type=number], input[type=text], select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #218838;
        }
        .flashcards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }
        .card {
            width: 18rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .card:hover {
            transform: scale(1.02);
        }
        .card-body {
            position: relative;
        }
        .answer {
            display: none;
            margin-top: 10px;
            color: #555;
        }
        .card.active .answer {
            display: block;
        }
        /* Styles pour masquer/afficher les sections */
        .input-section {
            display: none;
        }
        /* Style pour le chronomètre */
        #timer {
            display: none;
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Barre de navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
      <a class="navbar-brand" href="{% url 'flashcards:index' %}">Flashcards</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'flashcards:flashcard-list' %}">Liste des Flashcards</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'flashcards:flashcard-create' %}">Créer une Flashcard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'flashcards:generate_flashcards' %}">Générer Flashcards</a>
          </li>
        </ul>
      </div>
    </nav>

    <h1>Generate Flashcards</h1>
    
    <!-- Chronomètre -->
    <div id="timer">10</div>
    
    <form id="flashcardForm" method="POST">
        {% csrf_token %}
        <!-- Sélection de l'option : Texte, Thème ou Test -->
        <div class="form-group">
            <label>Choose Input Method:</label><br>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="input_method" id="inputText" value="text" checked>
                <label class="form-check-label" for="inputText">Text</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="input_method" id="inputTheme" value="theme">
                <label class="form-check-label" for="inputTheme">Theme</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="input_method" id="inputTest" value="test">
                <label class="form-check-label" for="inputTest">Test my knowledge</label>
            </div>
        </div>

        <!-- Section pour entrer le texte -->
        <div id="textSection" class="input-section">
            <textarea id="text" name="text" placeholder="Enter text here..."></textarea><br>
        </div>

        <!-- Section pour entrer le thème -->
        <div id="themeSection" class="input-section">
            <input type="text" id="theme" name="theme" placeholder="Enter theme (e.g., Big Data)"><br>
        </div>

        <!-- Section pour entrer le thème en mode test -->
        <div id="testSection" class="input-section">
            <!-- Pas besoin de choisir un thème en mode test -->
            <!-- Vous pouvez ajouter d'autres options si nécessaire -->
            <!-- Pour simplifier, nous allons récupérer toutes les flashcards sans filtrage -->
        </div>

        <!-- Champ pour spécifier le nombre de flashcards -->
        <input type="number" id="num_flashcards" name="num_flashcards_limit" placeholder="Number of Flashcards" required min="1"><br>

        <button type="submit">Generate Flashcards</button>
    </form>
    <div id="flashcards" class="flashcards-container"></div>



    <!-- Section pour afficher le flashcard en mode test -->
    <div id="testFlashcard" class="flashcards-container">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title" id="testQuestion">Question</h5>
                <p class="card-text answer" id="testAnswer">Answer</p>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Fonction pour afficher la section appropriée en fonction de l'option sélectionnée
        function toggleInputSections() {
            const inputMethod = document.querySelector('input[name="input_method"]:checked').value;
            const textSection = document.getElementById('textSection');
            const themeSection = document.getElementById('themeSection');
            const testSection = document.getElementById('testSection');

            if (inputMethod === 'text') {
                textSection.style.display = 'block';
                themeSection.style.display = 'none';
                testSection.style.display = 'none';
            } else if (inputMethod === 'theme') {
                textSection.style.display = 'none';
                themeSection.style.display = 'block';
                testSection.style.display = 'none';
            } else if (inputMethod === 'test') {
                textSection.style.display = 'none';
                themeSection.style.display = 'none';
                testSection.style.display = 'block';
            }
        }

        // Initialiser l'affichage au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            toggleInputSections();
            loadSavedFlashcards();  // Charger les flashcards sauvegardées

            // Ajouter des écouteurs d'événements pour les boutons radio
            const inputMethods = document.querySelectorAll('input[name="input_method"]');
            inputMethods.forEach(function(input) {
                input.addEventListener('change', toggleInputSections);
            });
        });

        // Gestion de la soumission du formulaire
        document.getElementById('flashcardForm').onsubmit = async function(e) {
            e.preventDefault();
            const inputMethod = document.querySelector('input[name="input_method"]:checked').value;
            const num_flashcards = document.getElementById('num_flashcards').value;
            let payload = { input_method: inputMethod, num_flashcards_limit: num_flashcards };
            let isTestMode = false;

            if (inputMethod === 'text') {
                const text = document.getElementById('text').value;
                payload.text = text;
            } else if (inputMethod === 'theme') {
                const theme = document.getElementById('theme').value;
                payload.theme = theme;
            } else if (inputMethod === 'test') {
                // En mode test, pas besoin de choisir un thème
                isTestMode = true;
            }

            const csrfToken = getCookie('csrftoken');

            if (isTestMode) {
                // Afficher le chronomètre initial (10 secondes) avant de commencer le test
                const initialTimerDiv = document.getElementById('initialTimer');
                initialTimerDiv.style.display = 'block';
                let timeLeft = 10; // 10 secondes

                initialTimerDiv.textContent = `Début du test dans ${timeLeft} secondes`;
                const countdown = setInterval(() => {
                    timeLeft--;
                    initialTimerDiv.textContent = `Début du test dans ${timeLeft} secondes`;
                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        initialTimerDiv.style.display = 'none';
                        submitFlashcardForm(payload, csrfToken, true); // Passer le flag isTestMode=true
                    }
                }, 1000);
            } else {
                // Soumettre immédiatement
                submitFlashcardForm(payload, csrfToken, false);
            }
        };

        // Fonction pour soumettre le formulaire
        async function submitFlashcardForm(payload, csrfToken, isTestMode) {
            try {
                const response = await fetch('{% url "flashcards:generate_flashcards" %}', {  // Utiliser le namespace
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken  // Inclure le token CSRF
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Unknown error occurred while generating flashcards.');
                }

                const data = await response.json();

                if (isTestMode) {
                    // Lancer le mode test avec les flashcards récupérées
                    startTestMode(data.flashcards);
                } else {
                    // Afficher les flashcards normalement
                    const flashcardsDiv = document.getElementById('flashcards');
                    flashcardsDiv.innerHTML = '';

                    if (data.flashcards && data.flashcards.length > 0) {
                        data.flashcards.forEach(flashcard => {
                            const card = document.createElement('div');
                            card.className = 'card';

                            const cardBody = document.createElement('div');
                            cardBody.className = 'card-body';

                            const question = document.createElement('h5');
                            question.className = 'card-title';
                            question.textContent = flashcard.question;

                            const answer = document.createElement('p');
                            answer.className = 'card-text answer';
                            answer.textContent = flashcard.answer;

                            cardBody.appendChild(question);
                            cardBody.appendChild(answer);
                            card.appendChild(cardBody);

                            // Ajouter un gestionnaire d'événements pour afficher la réponse au clic
                            card.addEventListener('click', function() {
                                this.classList.toggle('active');
                            });

                            flashcardsDiv.appendChild(card);
                        });

                        loadSavedFlashcards();  // Recharger les flashcards sauvegardées
                    } else {
                        flashcardsDiv.innerHTML = '<p>No flashcards generated.</p>';
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        }

        // Fonction pour démarrer le mode test
        function startTestMode(flashcards) {
            if (!flashcards || flashcards.length === 0) {
                alert('No flashcards available for the test.');
                return;
            }

            let currentIndex = 0;
            const total = flashcards.length;

            const testFlashcardDiv = document.getElementById('testFlashcard');
            const testQuestion = document.getElementById('testQuestion');
            const testAnswer = document.getElementById('testAnswer');

            testFlashcardDiv.style.display = 'block';

            function showNextFlashcard() {
                if (currentIndex >= total) {
                    alert('Test completed!');
                    testFlashcardDiv.style.display = 'none';
                    return;
                }

                const flashcard = flashcards[currentIndex];
                testQuestion.textContent = flashcard.question;
                testAnswer.textContent = flashcard.answer;
                testAnswer.style.display = 'none';

                let timeLeft = 5; // Temps en secondes avant d'afficher la réponse

                const timerDiv = document.getElementById('timer');
                timerDiv.style.display = 'block';
                timerDiv.textContent = `Réponse dans ${timeLeft} secondes`;

                const countdown = setInterval(() => {
                    timeLeft--;
                    timerDiv.textContent = `Réponse dans ${timeLeft} secondes`;
                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        timerDiv.style.display = 'none';
                        testAnswer.style.display = 'block';
                        currentIndex++;
                        // Attendre 3 secondes avant de passer au flashcard suivant
                        setTimeout(showNextFlashcard, 3000);
                    }
                }, 1000);
            }

            showNextFlashcard();
        }

        // Fonction pour obtenir le token CSRF depuis les cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Vérifie si ce cookie commence par le nom souhaité
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Fonction pour charger et afficher les flashcards sauvegardées
        async function loadSavedFlashcards() {
            try {
                const response = await fetch('{% url "flashcards:list_flashcards" %}');  // Utiliser le namespace
                if (!response.ok) {
                    throw new Error('Failed to fetch saved flashcards.');
                }
                const data = await response.json();
                const savedFlashcardsDiv = document.getElementById('savedFlashcards');
                savedFlashcardsDiv.innerHTML = '';

                if (data.flashcards && data.flashcards.length > 0) {
                    data.flashcards.forEach(flashcard => {
                        const card = document.createElement('div');
                        card.className = 'card';

                        const cardBody = document.createElement('div');
                        cardBody.className = 'card-body';

                        const question = document.createElement('h5');
                        question.className = 'card-title';
                        question.textContent = flashcard.question;

                        const answer = document.createElement('p');
                        answer.className = 'card-text answer';
                        answer.textContent = flashcard.answer;

                        cardBody.appendChild(question);
                        cardBody.appendChild(answer);
                        card.appendChild(cardBody);

                        // Ajouter un gestionnaire d'événements pour afficher la réponse au clic
                        card.addEventListener('click', function() {
                            this.classList.toggle('active');
                        });

                        savedFlashcardsDiv.appendChild(card);
                    });
                } else {
                    savedFlashcardsDiv.innerHTML = '<p>No saved flashcards.</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>
    <!-- Inclusion du footer -->
    {% include 'footer.html' %}